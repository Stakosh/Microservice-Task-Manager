<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestor de Tareas</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ENjdO4Dr2bkBIFxQpeoYz1FjaX0E3wG7Sk1vYjzv+0I5Fj6KpXhZlpb0JMZQ5h3" crossorigin="anonymous" />
</head>
<body style="background-color: {{ background_color }};">
  <div class="container py-5">
    <div class="text-center mb-5">
      <h1 class="display-4">Gestor de Tareas</h1>
      <p class="lead text-muted">MÃºltiples instancias balanceadas para alta disponibilidad</p>
    </div>

    <!-- Formulario de entrada -->
    <form action="{{ url_for('add_task') }}" method="post" class="input-group mb-4">
      <input
        type="text"
        name="title"
        class="form-control"
        placeholder="Ingrese una nueva tarea..."
        required
      />
      <button class="btn btn-success" type="submit">Agregar</button>
    </form>

    <!-- Lista de tareas -->
    {% if tasks %}
      <ul class="list-group">
        {% for task in tasks %}
          <li class="list-group-item d-flex justify-content-between align-items-center {% if task.completed %}list-group-item-secondary{% endif %}">
            <span class="flex-fill {% if task.completed %}text-decoration-line-through text-muted{% endif %}">{{ task.title }}</span>
            <div class="btn-group btn-group-sm">
              {% if not task.completed %}
                <form action="{{ url_for('complete_task', task_id=task.id) }}" method="post">
                  <button class="btn btn-primary" type="submit">
                    <i class="bi bi-check-circle"></i> Completar
                  </button>
                </form>
              {% endif %}
              <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post">
                <button class="btn btn-danger" type="submit">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="alert alert-secondary text-center">No hay tareas para mostrar.</div>
    {% endif %}

    <!-- Info del servidor -->
    <div class="alert alert-info text-center mt-5">
      <strong>Servidor:</strong> {{ request.host }}<br />
      <small class="text-muted">Actualizado cada 5s</small>
    </div>
  </div>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-q3+Yy6gIfdBcT3Xf6k4G0eVNG0a8r+2pH1+z7wexa2Y5G6ZQWn+ewNWlmJK1V07F" crossorigin="anonymous"></script>
  <!-- Icons (Bootstrap Icons) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <!-- Script para refrescar info -->
  <script>
    setInterval(() => {
      fetch("{{ url_for('server_info') }}")
        .then((res) => res.json())
        .then((data) => console.log("Info servidor:", data));
    }, 5000);
  </script>
</body>
</html>
